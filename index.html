<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTE Core ä¸ªæ€§åŒ–å¤ä¹ è®¡åˆ’è¡¨ V2.0</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 10px;
            background-color: #f5f7fa;
        }
        
        @media (max-width: 768px) {
            body {
                margin: 5px;
            }
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        
        .header p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .header h1 {
                font-size: 20px;
                margin-bottom: 8px;
            }
            
            .header p {
                font-size: 13px;
            }
        }
        
        .control-panel {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .control-panel {
                padding: 12px;
                margin-bottom: 12px;
            }
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            .mode-selector {
                gap: 8px;
                margin-bottom: 15px;
            }
        }
        
        .mode-btn {
            padding: 12px 25px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .mode-btn {
                padding: 10px 15px;
                font-size: 13px;
                flex: 1;
                min-width: 120px;
            }
        }
        
        .mode-btn.active {
            background: #4299e1;
            color: white;
            border-color: #4299e1;
        }
        
        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .customization-area {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .week-customizer {
            background: white;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .day-editor {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 15px;
            align-items: start;
            margin: 10px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        @media (max-width: 768px) {
            .day-editor {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
                margin: 8px 0;
            }
        }
        
        .task-editor {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 8px;
        }
        
        @media (max-width: 768px) {
            .task-editor {
                flex-direction: column;
                align-items: stretch;
                padding: 8px;
                gap: 6px;
            }
        }
        
        .task-input {
            flex: 1;
            margin: 0 10px;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
            min-width: 200px;
        }
        
        @media (max-width: 768px) {
            .task-input {
                margin: 0;
                min-width: auto;
                width: 100%;
            }
        }
        
        .task-time {
            width: 80px;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            margin-right: 10px;
            text-align: center;
        }
        
        .task-type-select, .task-subtype-select {
            width: 100px;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .task-subtype-select {
            width: 120px;
        }
        
        @media (max-width: 768px) {
            .task-time {
                width: 100%;
                margin-right: 0;
            }
            
            .task-type-select, .task-subtype-select {
                width: 100%;
                margin-right: 0;
            }
        }
        
        .delete-btn, .add-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .delete-btn {
            background: #f56565;
            color: white;
        }
        
        .delete-btn:hover {
            background: #e53e3e;
        }
        
        .add-btn {
            background: #48bb78;
            color: white;
            margin-top: 10px;
        }
        
        .add-btn:hover {
            background: #38a169;
        }
        
        .schedule-display {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .schedule-display {
                padding: 10px;
                margin: 10px 0;
            }
        }
        
        .week-header {
            background: #2d3748;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
            font-size: 18px;
        }
        
        @media (max-width: 768px) {
            .week-header {
                padding: 12px;
                font-size: 16px;
            }
        }
        
        .day-row {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 20px;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            align-items: start;
        }
        
        @media (max-width: 768px) {
            .day-row {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
            }
        }
        
        .day-row:last-child {
            border-bottom: none;
        }
        
        .day-label {
            font-weight: bold;
            background: #edf2f7;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
        }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid transparent;
            transition: all 0.2s;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        @media (max-width: 768px) {
            .task-item {
                padding: 8px;
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
        }
        
        .task-item:hover {
            background: #edf2f7;
        }
        
        .task-item.speaking { border-left-color: #f56565; }
        .task-item.writing { border-left-color: #48bb78; }
        .task-item.listening { border-left-color: #4299e1; }
        .task-item.reading { border-left-color: #ed8936; }
        
        .task-checkbox {
            margin-right: 12px;
            transform: scale(1.3);
            cursor: pointer;
        }
        
        .task-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .task-text {
                font-size: 13px;
                width: 100%;
            }
        }
        
        .task-time-badge {
            background: #4299e1;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
            font-weight: bold;
        }
        
        .task-subtype-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            color: white;
            margin-left: 0;
            margin-right: 8px;
        }
        
        .subtype-speaking { background: #f56565; }
        .subtype-writing { background: #48bb78; }
        .subtype-listening { background: #4299e1; }
        .subtype-reading { background: #ed8936; }
        
        .progress-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .progress-section {
                padding: 12px;
                margin: 12px 0;
            }
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #667eea);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                gap: 10px;
                margin: 15px 0;
            }
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .btn {
                padding: 10px 15px;
                font-size: 13px;
                flex: 1;
                min-width: 100px;
                white-space: nowrap;
            }
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-primary { background: #4299e1; color: white; }
        .btn-success { background: #48bb78; color: white; }
        .btn-warning { background: #ed8936; color: white; }
        .btn-danger { background: #f56565; color: white; }
        
        .priority-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .priority-section {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .priority-section p {
                font-size: 13px;
                line-height: 1.4;
            }
        }
        
        .priority-title {
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .tier1 { background-color: #ff6b6b; color: white; }
        .tier2 { background-color: #ffa726; color: white; }
        .tier3 { background-color: #66bb6a; color: white; }
        
        .legend {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .legend {
                justify-content: center;
                gap: 8px;
                margin: 15px 0;
            }
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 8px 12px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-size: 13px;
        }
        
        @media (max-width: 768px) {
            .legend-item {
                padding: 6px 10px;
                font-size: 12px;
                flex: 1;
                min-width: 80px;
                justify-content: center;
            }
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 8px;
        }
        
        .week-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .default-schedule-info {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .subtype-info {
            background: #f0f9ff;
            border: 1px solid #90cdf4;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .subtype-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .subtype-category {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid;
        }
        
        .subtype-category.speaking { border-left-color: #f56565; }
        .subtype-category.writing { border-left-color: #48bb78; }
        .subtype-category.reading { border-left-color: #ed8936; }
        .subtype-category.listening { border-left-color: #4299e1; }
        
        .subtype-category h5 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        
        .subtype-category p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ PTE Core å¤ä¹ è®¡åˆ’è¡¨ V2.0</h1>
        <p>æ”¯æŒé¢˜å‹åˆ†ç±»çš„ä¸ªæ€§åŒ–å­¦ä¹ è®¡åˆ’å·¥å…·</p>
    </div>

    <!-- é¢˜å‹ä¼˜å…ˆçº§è¯´æ˜ -->
    <div class="priority-section">
        <div class="priority-title tier1">ç¬¬ä¸€æ¢¯é˜Ÿï¼ˆå¿…èƒŒé¢˜åº“ï¼‰</div>
        <p><strong>RA, RS, FIB-RW, FIB-L, WFD, WE</strong> - æœ€é«˜ä¼˜å…ˆçº§ï¼Œå¿…é¡»ç†Ÿç»ƒæŒæ¡</p>
        
        <div class="priority-title tier2">ç¬¬äºŒæ¢¯é˜Ÿï¼ˆé‡è¦ç»ƒä¹ ï¼‰</div>
        <p><strong>SST, SWT, FIB-R, RO, DI, RTS</strong> - é«˜ä¼˜å…ˆçº§ï¼Œéœ€è¦å……åˆ†ç»ƒä¹ </p>
        
        <div class="priority-title tier3">ç¬¬ä¸‰æ¢¯é˜Ÿï¼ˆè¾…åŠ©ç»ƒä¹ ï¼‰</div>
        <p><strong>ASQ, HIW, SMW, MCS, MCM</strong> - ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œç†Ÿæ‚‰é¢˜å‹å³å¯</p>
    </div>

    <!-- é¢˜å‹åˆ†ç±»è¯´æ˜ -->
    <div class="subtype-info">
        <h4>ğŸ“‘ é¢˜å‹åˆ†ç±»è¯´æ˜</h4>
        <div class="subtype-grid">
            <div class="subtype-category speaking">
                <h5>ğŸ—£ï¸ å£è¯­é¢˜å‹</h5>
                <p>RA, RS, DI, RTS, ASQ</p>
            </div>
            <div class="subtype-category writing">
                <h5>âœï¸ å†™ä½œé¢˜å‹</h5>
                <p>WE, SWT</p>
            </div>
            <div class="subtype-category reading">
                <h5>ğŸ“– é˜…è¯»é¢˜å‹</h5>
                <p>FIB-RW, MCM-R, RO, FIB-R, MCS-R</p>
            </div>
            <div class="subtype-category listening">
                <h5>ğŸ‘‚ å¬åŠ›é¢˜å‹</h5>
                <p>SST, MCM-L, FIB-L, MCS-L, SMW, HIW, WFD</p>
            </div>
        </div>
    </div>

    <!-- æ¨¡å¼é€‰æ‹©åŒºåŸŸ -->
    <div class="control-panel">
        <h3>ğŸ“‹ é€‰æ‹©æ¨¡å¼</h3>
        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('use', this)">ğŸ“š ä½¿ç”¨æ¨¡å¼</button>
            <button class="mode-btn" onclick="switchMode('custom', this)">âš™ï¸ è‡ªå®šä¹‰ç¼–è¾‘</button>
        </div>

        <!-- è‡ªå®šä¹‰ç¼–è¾‘åŒºåŸŸ -->
        <div id="custom-area" class="customization-area">
            <h4>ğŸ› ï¸ è‡ªå®šä¹‰ä½ çš„å­¦ä¹ è®¡åˆ’ï¼š</h4>
            <div class="default-schedule-info">
                <h4>ğŸ’¡ æç¤º</h4>
                <p>ç³»ç»Ÿå·²ä¸ºä½ é¢„è®¾äº†ä¸€ä¸ªæ ‡å‡†çš„ä¸‰å‘¨å¤ä¹ è®¡åˆ’ã€‚ä½ å¯ä»¥ï¼š</p>
                <ul>
                    <li>ä¿®æ”¹ç°æœ‰ä»»åŠ¡çš„å†…å®¹å’Œæ—¶é—´</li>
                    <li>é€‰æ‹©å…·ä½“çš„é¢˜å‹ï¼ˆå¦‚RAã€RSç­‰ï¼‰</li>
                    <li>æ·»åŠ æˆ–åˆ é™¤ä»»åŠ¡</li>
                    <li>æ ¹æ®è‡ªå·±çš„è¿›åº¦è‡ªç”±å®‰æ’</li>
                </ul>
            </div>
            <div id="week-editors"></div>
            <button onclick="addWeek()" class="btn btn-success">+ æ·»åŠ æ–°å‘¨</button>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-buttons">
            <button onclick="savePlan()" class="btn btn-primary">ğŸ’¾ ä¿å­˜è®¡åˆ’</button>
            <button onclick="exportToExcel()" class="btn btn-success">ğŸ“Š å¯¼å‡ºExcel</button>
            <button onclick="resetPlan()" class="btn btn-danger">ğŸ”„ é‡ç½®è®¡åˆ’</button>
        </div>
    </div>

    <!-- è¿›åº¦è·Ÿè¸ªåŒºåŸŸ -->
    <div class="progress-section">
        <h3>ğŸ“Š å­¦ä¹ è¿›åº¦</h3>
        <div id="progress-display"></div>
    </div>

    <!-- å›¾ä¾‹ -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #f56565;"></div>
            <span>å£è¯­ç»ƒä¹ </span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #48bb78;"></div>
            <span>å†™ä½œç»ƒä¹ </span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4299e1;"></div>
            <span>å¬åŠ›ç»ƒä¹ </span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #ed8936;"></div>
            <span>é˜…è¯»ç»ƒä¹ </span>
        </div>
    </div>

    <!-- è®¡åˆ’æ˜¾ç¤ºåŒºåŸŸ -->
    <div id="schedule-container"></div>

    <script>
        // å…¨å±€å˜é‡
        let currentSchedule = {};
        let currentMode = 'use';

        // é¢˜å‹æ˜ å°„
        const subtypeMap = {
            speaking: {
                name: "å£è¯­",
                subtypes: ["RA", "RS", "DI", "RTS", "ASQ"]
            },
            writing: {
                name: "å†™ä½œ",
                subtypes: ["WE", "SWT"]
            },
            reading: {
                name: "é˜…è¯»",
                subtypes: ["FIB-RW", "MCM-R", "RO", "FIB-R", "MCS-R"]
            },
            listening: {
                name: "å¬åŠ›",
                subtypes: ["SST", "MCM-L", "FIB-L", "MCS-L", "SMW", "HIW", "WFD"]
            }
        };

        // é»˜è®¤æ ‡å‡†è®¡åˆ’
        const defaultSchedule = {
            name: "æ ‡å‡†ä¸‰å‘¨è®¡åˆ’",
            weeks: {
                "ç¬¬ä¸€å‘¨": {
                    "å‘¨ä¸€": [
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ï¼Œç›®æ ‡CLB7(70+)/CLB8(75+)/CLB9(85+)", time: "15åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "WE #1, #5 å†™ä½œå¹¶èƒŒç†Ÿ", time: "30åˆ†é’Ÿ"},
                        {type: "listening", subtype: "SST", task: "SST #2 å†™ä½œå¹¶èƒŒç†Ÿ", time: "15åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "FIB-RW ç¬¬ä¸€é (1/3) - PTEé¢˜åº“Reading", time: "30åˆ†é’Ÿ"}
                    ],
                    "å‘¨äºŒ": [
                        {type: "speaking", subtype: "RS", task: "RS èƒŒé¢˜åº“ç¬¬ä¸€é (1/3) - PTEé¢˜åº“Speaking", time: "30åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "WE #2, #3, #4 å†™ä½œå¹¶èƒŒç†Ÿ", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "FIB-RW ç¬¬ä¸€é (2/3) - PTEé¢˜åº“Reading", time: "30åˆ†é’Ÿ"}
                    ],
                    "å‘¨ä¸‰": [
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "15åˆ†é’Ÿ"},
                        {type: "writing", subtype: "SWT", task: "SWT #1-6, #8 å†™ä½œå¹¶èƒŒç†Ÿ", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "FIB-RW ç¬¬ä¸€é (3/3) - PTEé¢˜åº“Reading", time: "30åˆ†é’Ÿ"}
                    ],
                    "å‘¨å››": [
                        {type: "speaking", subtype: "RS", task: "RS èƒŒé¢˜åº“ç¬¬ä¸€é (2/3) - PTEé¢˜åº“Speaking", time: "30åˆ†é’Ÿ"},
                        {type: "listening", subtype: "SST", task: "SST #1-6, #8 å†™ä½œå¹¶èƒŒç†Ÿ", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-R", task: "FIB-R ç¬¬ä¸€é (1/2) - PTEé¢˜åº“Reading", time: "30åˆ†é’Ÿ"}
                    ],
                    "å‘¨äº”": [
                        {type: "speaking", subtype: "RS", task: "RS èƒŒé¢˜åº“ç¬¬ä¸€é (3/3) - PTEé¢˜åº“Speaking", time: "30åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "WE #6-8 å†™ä½œå¹¶èƒŒç†Ÿ", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-R", task: "FIB-R ç¬¬ä¸€é (2/2) - PTEé¢˜åº“Reading", time: "30åˆ†é’Ÿ"}
                    ],
                    "å‘¨å…­": [
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "15åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "WE #9-10 å†™ä½œå¹¶èƒŒç†Ÿ", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "å¤ä¹ æœ¬å‘¨FIB-RWå’ŒFIB-R", time: "60åˆ†é’Ÿ"}
                    ]
                },
                "ç¬¬äºŒå‘¨": {
                    "å‘¨ä¸€": [
                        {type: "speaking", subtype: "DI", task: "DI 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RTS", task: "RTS 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "ASQ", task: "ASQ (1/4)", time: "10åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "WE #11-14", time: "45åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "FIB-L å•è¯è¡¨ + ç»ƒä¹ PDF (1/3)", time: "45åˆ†é’Ÿ"}
                    ],
                    "å‘¨äºŒ": [
                        {type: "speaking", subtype: "RS", task: "RS èƒŒé¢˜åº“ç¬¬äºŒé (1/2)", time: "30åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "å¤ä¹ æ‰€æœ‰å†™è¿‡çš„WE", time: "30åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "FIB-L ç»ƒä¹ PDF (2/3)", time: "45åˆ†é’Ÿ"}
                    ],
                    "å‘¨ä¸‰": [
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "ASQ", task: "ASQ (2/4)", time: "10åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬ä¸€é (1/4)", time: "45åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "FIB-L ç»ƒä¹ PDF (3/3)", time: "45åˆ†é’Ÿ"}
                    ],
                    "å‘¨å››": [
                        {type: "speaking", subtype: "RS", task: "RS èƒŒé¢˜åº“ç¬¬äºŒé (2/2)", time: "30åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬ä¸€é (2/4)", time: "45åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "èƒŒæ‰€æœ‰ç»ƒä¹ è¿‡çš„FIB-Lå•è¯", time: "45åˆ†é’Ÿ"}
                    ],
                    "å‘¨äº”": [
                        {type: "speaking", subtype: "DI", task: "DI 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RTS", task: "RTS 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "ASQ", task: "ASQ (3/4)", time: "10åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬ä¸€é (3/4)", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-R", task: "FIB-R ç¬¬äºŒé (1/2)", time: "45åˆ†é’Ÿ"}
                    ],
                    "å‘¨å…­": [
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "ASQ", task: "ASQ (4/4)", time: "10åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬ä¸€é (4/4)", time: "45åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "å¤ä¹ æœ¬å‘¨æ‰€æœ‰FIB-L", time: "60åˆ†é’Ÿ"}
                    ]
                },
                "ç¬¬ä¸‰å‘¨": {
                    "å‘¨ä¸€": [
                        {type: "speaking", subtype: "RS", task: "RS ç¬¬äºŒé (1/3)", time: "15åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "å¤ä¹  WE, SWT", time: "30åˆ†é’Ÿ"},
                        {type: "listening", subtype: "SST", task: "å¤ä¹  SST", time: "15åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "FIB-L ç¬¬äºŒé (1/2)", time: "25åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "FIB-RW ç¬¬äºŒé (1/2)", time: "20åˆ†é’Ÿ"}
                    ],
                    "å‘¨äºŒ": [
                        {type: "speaking", subtype: "RS", task: "RS ç¬¬äºŒé (2/3)", time: "20åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬äºŒé (1/3)", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "RO", task: "RO é¡ºå£æºœç¬¬ä¸€é", time: "30åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-R", task: "FIB-R ç¬¬äºŒé (1/2)", time: "30åˆ†é’Ÿ"}
                    ],
                    "å‘¨ä¸‰": [
                        {type: "speaking", subtype: "RS", task: "RS ç¬¬äºŒé (3/3)", time: "15åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬äºŒé (2/3)", time: "45åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "FIB-L ç¬¬äºŒé (2/2)", time: "25åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "FIB-RW ç¬¬äºŒé (2/2)", time: "20åˆ†é’Ÿ"}
                    ],
                    "å‘¨å››": [
                        {type: "speaking", subtype: "RS", task: "RS ç¬¬ä¸‰é (1/3)", time: "15åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬äºŒé (3/3)", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "RO", task: "RO é¡ºå£æºœç¬¬äºŒé", time: "30åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-R", task: "FIB-R ç¬¬äºŒé (2/2)", time: "30åˆ†é’Ÿ"}
                    ],
                    "å‘¨äº”": [
                        {type: "speaking", subtype: "RS", task: "RS ç¬¬ä¸‰é (2/3)", time: "15åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "writing", subtype: "WE", task: "å¤ä¹  WE, SWT", time: "30åˆ†é’Ÿ"},
                        {type: "listening", subtype: "SST", task: "å¤ä¹  SST", time: "15åˆ†é’Ÿ"},
                        {type: "listening", subtype: "FIB-L", task: "FIB-L ç¬¬ä¸‰éå®Œæ•´å¤ä¹ ", time: "25åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "FIB-RW ç¬¬ä¸‰é", time: "20åˆ†é’Ÿ"}
                    ],
                    "å‘¨å…­": [
                        {type: "speaking", subtype: "RS", task: "RS ç¬¬ä¸‰é (3/3)", time: "15åˆ†é’Ÿ"},
                        {type: "speaking", subtype: "RA", task: "RA 5é¢˜ç»ƒä¹ ", time: "10åˆ†é’Ÿ"},
                        {type: "listening", subtype: "WFD", task: "WFD èƒŒé¢˜åº“ç¬¬ä¸‰éå®Œæ•´å¤ä¹ ", time: "45åˆ†é’Ÿ"},
                        {type: "reading", subtype: "FIB-RW", task: "æ€»å¤ä¹  FIB-RW, FIB-L, FIB-R, RO", time: "60åˆ†é’Ÿ"}
                    ]
                }
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadDefaultSchedule();
            updateDisplay();
            loadProgress();
        });

        // åŠ è½½é»˜è®¤è®¡åˆ’
        function loadDefaultSchedule() {
            const saved = loadPlan();
            if (saved && saved.weeks) {
                currentSchedule = saved;
            } else {
                currentSchedule = JSON.parse(JSON.stringify(defaultSchedule));
            }
        }

        // æ¨¡å¼åˆ‡æ¢
        function switchMode(mode, element) {
            currentMode = mode;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (element) {
                element.classList.add('active');
            }
            
            // æ˜¾ç¤º/éšè—å¯¹åº”åŒºåŸŸ
            document.querySelectorAll('.customization-area').forEach(area => {
                area.style.display = 'none';
            });
            
            if (mode === 'custom') {
                document.getElementById('custom-area').style.display = 'block';
                generateWeekEditors();
            }
        }

        // ç”Ÿæˆå‘¨ç¼–è¾‘å™¨
        function generateWeekEditors() {
            const container = document.getElementById('week-editors');
            container.innerHTML = '';
            
            Object.keys(currentSchedule.weeks || {}).forEach(weekName => {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'week-customizer';
                weekDiv.innerHTML = `
                    <div class="week-editor-header">
                        <h4>${weekName}</h4>
                        <button onclick="deleteWeek('${weekName}')" class="delete-btn">åˆ é™¤å‘¨</button>
                    </div>
                    <div id="days-${weekName}"></div>
                    <button onclick="addDay('${weekName}')" class="add-btn">+ æ·»åŠ æ–°ä¸€å¤©</button>
                `;
                container.appendChild(weekDiv);
                
                generateDayEditors(weekName);
            });
        }

        // ç”Ÿæˆå¤©ç¼–è¾‘å™¨
        function generateDayEditors(weekName) {
            const container = document.getElementById(`days-${weekName}`);
            container.innerHTML = '';
            
            Object.keys(currentSchedule.weeks[weekName] || {}).forEach(dayName => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-editor';
                dayDiv.innerHTML = `
                    <div>
                        <div class="day-label">${dayName}</div>
                        <button onclick="deleteDay('${weekName}', '${dayName}')" class="delete-btn" style="margin-top: 10px;">åˆ é™¤å¤©</button>
                    </div>
                    <div id="tasks-${weekName}-${dayName}"></div>
                `;
                container.appendChild(dayDiv);
                
                generateTaskEditors(weekName, dayName);
                
                const addTaskBtn = document.createElement('button');
                addTaskBtn.className = 'add-btn';
                addTaskBtn.textContent = '+ æ·»åŠ ä»»åŠ¡';
                addTaskBtn.onclick = () => addTask(weekName, dayName);
                dayDiv.querySelector(`#tasks-${weekName}-${dayName}`).appendChild(addTaskBtn);
            });
        }

        // ç”Ÿæˆä»»åŠ¡ç¼–è¾‘å™¨
        function generateTaskEditors(weekName, dayName) {
            const container = document.getElementById(`tasks-${weekName}-${dayName}`);
            const tasks = currentSchedule.weeks[weekName][dayName] || [];
            
            tasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'task-editor';
                
                // ç”Ÿæˆé¢˜å‹å­é€‰é¡¹
                const subtypeOptions = task.type && subtypeMap[task.type] ? 
                    subtypeMap[task.type].subtypes.map(st => 
                        `<option value="${st}" ${task.subtype === st ? 'selected' : ''}>${st}</option>`
                    ).join('') : '';
                
                taskDiv.innerHTML = `
                    <select class="task-type-select" onchange="updateTaskType('${weekName}', '${dayName}', ${index}, this.value)">
                        <option value="speaking" ${task.type === 'speaking' ? 'selected' : ''}>å£è¯­</option>
                        <option value="writing" ${task.type === 'writing' ? 'selected' : ''}>å†™ä½œ</option>
                        <option value="listening" ${task.type === 'listening' ? 'selected' : ''}>å¬åŠ›</option>
                        <option value="reading" ${task.type === 'reading' ? 'selected' : ''}>é˜…è¯»</option>
                    </select>
                    <select class="task-subtype-select" onchange="updateTask('${weekName}', '${dayName}', ${index}, 'subtype', this.value)">
                        ${subtypeOptions}
                    </select>
                    <input type="text" class="task-input" value="${task.task}" 
                           onchange="updateTask('${weekName}', '${dayName}', ${index}, 'task', this.value)" 
                           placeholder="ä»»åŠ¡æè¿°">
                    <input type="text" class="task-time" value="${task.time}" 
                           onchange="updateTask('${weekName}', '${dayName}', ${index}, 'time', this.value)" 
                           placeholder="æ—¶é—´">
                    <button onclick="deleteTask('${weekName}', '${dayName}', ${index})" class="delete-btn">åˆ é™¤</button>
                `;
                container.appendChild(taskDiv);
            });
        }

        // æ›´æ–°ä»»åŠ¡ç±»å‹
        function updateTaskType(weekName, dayName, taskIndex, newType) {
            if (!currentSchedule.weeks[weekName] || !currentSchedule.weeks[weekName][dayName]) return;
            
            if (currentSchedule.weeks[weekName][dayName][taskIndex]) {
                currentSchedule.weeks[weekName][dayName][taskIndex].type = newType;
                // è®¾ç½®æ–°ç±»å‹çš„ç¬¬ä¸€ä¸ªå­ç±»å‹
                if (subtypeMap[newType]) {
                    currentSchedule.weeks[weekName][dayName][taskIndex].subtype = subtypeMap[newType].subtypes[0];
                }
                generateDayEditors(weekName);
                updateDisplay();
            }
        }

        // æ›´æ–°ä»»åŠ¡
        function updateTask(weekName, dayName, taskIndex, field, value) {
            if (!currentSchedule.weeks[weekName] || !currentSchedule.weeks[weekName][dayName]) return;
            
            if (currentSchedule.weeks[weekName][dayName][taskIndex]) {
                currentSchedule.weeks[weekName][dayName][taskIndex][field] = value;
                updateDisplay();
            }
        }

        // æ·»åŠ ä»»åŠ¡
        function addTask(weekName, dayName) {
            if (!currentSchedule.weeks[weekName]) currentSchedule.weeks[weekName] = {};
            if (!currentSchedule.weeks[weekName][dayName]) currentSchedule.weeks[weekName][dayName] = [];
            
            currentSchedule.weeks[weekName][dayName].push({
                type: 'speaking',
                subtype: 'RA',
                task: 'æ–°ä»»åŠ¡',
                time: '30åˆ†é’Ÿ'
            });
            
            generateDayEditors(weekName);
            updateDisplay();
        }

        // åˆ é™¤ä»»åŠ¡
        function deleteTask(weekName, dayName, taskIndex) {
            if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
                currentSchedule.weeks[weekName][dayName].splice(taskIndex, 1);
                generateDayEditors(weekName);
                updateDisplay();
            }
        }

        // æ·»åŠ å¤©
        function addDay(weekName) {
            const dayName = prompt('è¯·è¾“å…¥æ–°ä¸€å¤©çš„åç§°ï¼ˆå¦‚ï¼šå‘¨æ—¥ï¼‰ï¼š');
            if (dayName && dayName.trim()) {
                if (!currentSchedule.weeks[weekName][dayName.trim()]) {
                    currentSchedule.weeks[weekName][dayName.trim()] = [];
                    generateDayEditors(weekName);
                } else {
                    alert('è¯¥å¤©å·²å­˜åœ¨ï¼');
                }
            }
        }

        // åˆ é™¤å¤©
        function deleteDay(weekName, dayName) {
            if (confirm(`ç¡®å®šåˆ é™¤ ${dayName} å—ï¼Ÿ`)) {
                delete currentSchedule.weeks[weekName][dayName];
                generateDayEditors(weekName);
                updateDisplay();
            }
        }

        // æ·»åŠ å‘¨
        function addWeek() {
            const weekName = prompt('è¯·è¾“å…¥æ–°å‘¨çš„åç§°ï¼ˆå¦‚ï¼šç¬¬å››å‘¨ï¼‰ï¼š');
            if (weekName && weekName.trim()) {
                if (!currentSchedule.weeks) currentSchedule.weeks = {};
                if (!currentSchedule.weeks[weekName.trim()]) {
                    currentSchedule.weeks[weekName.trim()] = {};
                    generateWeekEditors();
                } else {
                    alert('è¯¥å‘¨å·²å­˜åœ¨ï¼');
                }
            }
        }

        // åˆ é™¤å‘¨
        function deleteWeek(weekName) {
            if (confirm(`ç¡®å®šåˆ é™¤ ${weekName} å—ï¼Ÿ`)) {
                delete currentSchedule.weeks[weekName];
                generateWeekEditors();
                updateDisplay();
            }
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const container = document.getElementById('schedule-container');
            container.innerHTML = '';
            
            if (!currentSchedule.weeks) return;
            
            Object.keys(currentSchedule.weeks).forEach(weekName => {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'schedule-display';
                
                const weekHeader = document.createElement('div');
                weekHeader.className = 'week-header';
                weekHeader.textContent = weekName;
                weekDiv.appendChild(weekHeader);
                
                Object.keys(currentSchedule.weeks[weekName]).forEach(dayName => {
                    const dayRow = document.createElement('div');
                    dayRow.className = 'day-row';
                    
                    const dayLabel = document.createElement('div');
                    dayLabel.className = 'day-label';
                    dayLabel.textContent = dayName;
                    
                    const taskList = document.createElement('div');
                    taskList.className = 'task-list';
                    
                    currentSchedule.weeks[weekName][dayName].forEach((task, index) => {
                        const taskItem = document.createElement('div');
                        taskItem.className = `task-item ${task.type}`;
                        taskItem.innerHTML = `
                            <input type="checkbox" class="task-checkbox" data-week="${weekName}" data-day="${dayName}" data-task="${index}">
                            ${task.subtype ? `<span class="task-subtype-badge subtype-${task.type}">${task.subtype}</span>` : ''}
                            <div style="display: flex; align-items: center; flex: 1; flex-wrap: wrap; gap: 8px;">
                                <span class="task-text">${task.task}</span>
                                <span class="task-time-badge">${task.time}</span>
                            </div>
                        `;
                        taskList.appendChild(taskItem);
                    });
                    
                    dayRow.appendChild(dayLabel);
                    dayRow.appendChild(taskList);
                    weekDiv.appendChild(dayRow);
                });
                
                container.appendChild(weekDiv);
            });
            
            updateProgress();
            attachCheckboxListeners();
        }

        // é™„åŠ å¤é€‰æ¡†ç›‘å¬å™¨
        function attachCheckboxListeners() {
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateProgress();
                    saveProgress();
                });
            });
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progressDisplay = document.getElementById('progress-display');
            progressDisplay.innerHTML = '';
            
            if (!currentSchedule.weeks) return;
            
            let totalTasks = 0;
            let completedTasks = 0;
            
            Object.keys(currentSchedule.weeks).forEach(weekName => {
                const weekCheckboxes = document.querySelectorAll(`input[data-week="${weekName}"]`);
                const weekChecked = document.querySelectorAll(`input[data-week="${weekName}"]:checked`);
                const weekProgress = weekCheckboxes.length > 0 ? Math.round((weekChecked.length / weekCheckboxes.length) * 100) : 0;
                
                totalTasks += weekCheckboxes.length;
                completedTasks += weekChecked.length;
                
                const weekProgressDiv = document.createElement('div');
                weekProgressDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span><strong>${weekName}</strong></span>
                        <span>${weekProgress}% (${weekChecked.length}/${weekCheckboxes.length})</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${weekProgress}%"></div>
                    </div>
                    <div style="margin-bottom: 15px;"></div>
                `;
                progressDisplay.appendChild(weekProgressDiv);
            });
            
            // æ€»ä½“è¿›åº¦
            const totalProgress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            const totalProgressDiv = document.createElement('div');
            totalProgressDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 18px;">
                    <span><strong>ğŸ¯ æ€»ä½“è¿›åº¦</strong></span>
                    <span><strong>${totalProgress}% (${completedTasks}/${totalTasks})</strong></span>
                </div>
                <div class="progress-bar" style="height: 25px;">
                    <div class="progress-fill" style="width: ${totalProgress}%"></div>
                </div>
            `;
            progressDisplay.insertBefore(totalProgressDiv, progressDisplay.firstChild);
        }

        // ä¿å­˜è¿›åº¦
        function saveProgress() {
            const checkboxes = document.querySelectorAll('.task-checkbox');
            const progress = {};
            checkboxes.forEach(checkbox => {
                const key = `${checkbox.dataset.week}-${checkbox.dataset.day}-${checkbox.dataset.task}`;
                progress[key] = checkbox.checked;
            });
            
            try {
                localStorage.setItem('pte_progress', JSON.stringify(progress));
            } catch (e) {
                console.log('æ— æ³•ä¿å­˜è¿›åº¦');
            }
        }

        // åŠ è½½è¿›åº¦
        function loadProgress() {
            try {
                const progress = JSON.parse(localStorage.getItem('pte_progress')) || {};
                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    const key = `${checkbox.dataset.week}-${checkbox.dataset.day}-${checkbox.dataset.task}`;
                    if (progress[key]) {
                        checkbox.checked = true;
                    }
                });
                updateProgress();
            } catch (e) {
                console.log('æ— æ³•åŠ è½½è¿›åº¦');
            }
        }

        // ä¿å­˜è®¡åˆ’
        function savePlan() {
            try {
                localStorage.setItem('pte_custom_plan', JSON.stringify(currentSchedule));
                alert('âœ… è®¡åˆ’å·²ä¿å­˜åˆ°æœ¬åœ°ï¼');
            } catch (e) {
                alert('âŒ ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
            }
        }

        // åŠ è½½è®¡åˆ’
        function loadPlan() {
            try {
                const saved = localStorage.getItem('pte_custom_plan');
                return saved ? JSON.parse(saved) : null;
            } catch (e) {
                return null;
            }
        }

        // å¯¼å‡ºExcelæ ¼å¼
        function exportToExcel() {
            let csvContent = "å‘¨æ¬¡,æ—¥æœŸ,ä»»åŠ¡ç±»å‹,é¢˜å‹,ä»»åŠ¡å†…å®¹,æ—¶é—´,å®ŒæˆçŠ¶æ€\n";
            
            Object.keys(currentSchedule.weeks).forEach(weekName => {
                Object.keys(currentSchedule.weeks[weekName]).forEach(dayName => {
                    currentSchedule.weeks[weekName][dayName].forEach((task, index) => {
                        const checkbox = document.querySelector(`input[data-week="${weekName}"][data-day="${dayName}"][data-task="${index}"]`);
                        const status = checkbox && checkbox.checked ? "å·²å®Œæˆ" : "æœªå®Œæˆ";
                        const typeMap = {
                            speaking: "å£è¯­",
                            writing: "å†™ä½œ", 
                            listening: "å¬åŠ›",
                            reading: "é˜…è¯»"
                        };
                        
                        csvContent += `"${weekName}","${dayName}","${typeMap[task.type]}","${task.subtype || ''}","${task.task}","${task.time}","${status}"\n`;
                    });
                });
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `PTE_Core_å¤ä¹ è®¡åˆ’_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('ğŸ“Š Excelæ–‡ä»¶å·²å¯¼å‡ºï¼\n\nğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š\nâ€¢ ç”¨Excelæˆ–WPSæ‰“å¼€ä¸‹è½½çš„CSVæ–‡ä»¶\nâ€¢ å¯ä»¥è¿›ä¸€æ­¥ç¼–è¾‘å’Œç¾åŒ–\nâ€¢ åˆ†äº«ç»™æœ‹å‹æˆ–å¯¼å¸ˆæŸ¥çœ‹è¿›åº¦');
        }

        // é‡ç½®è®¡åˆ’
        function resetPlan() {
            if (confirm('ğŸ”„ ç¡®å®šè¦é‡ç½®å—ï¼Ÿ\n\nè¿™å°†ï¼š\nâ€¢ æ¢å¤åˆ°é»˜è®¤çš„ä¸‰å‘¨è®¡åˆ’\nâ€¢ æ¸…é™¤æ‰€æœ‰å­¦ä¹ è¿›åº¦\nâ€¢ åˆ é™¤è‡ªå®šä¹‰ä¿®æ”¹\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                currentSchedule = JSON.parse(JSON.stringify(defaultSchedule));
                
                updateDisplay();
                
                try {
                    localStorage.removeItem('pte_custom_plan');
                    localStorage.removeItem('pte_progress');
                } catch (e) {
                    console.log('æ— æ³•æ¸…é™¤æœ¬åœ°å­˜å‚¨');
                }
                
                // å¦‚æœåœ¨ç¼–è¾‘æ¨¡å¼ï¼Œé‡æ–°ç”Ÿæˆç¼–è¾‘å™¨
                if (currentMode === 'custom') {
                    generateWeekEditors();
                }
                
                alert('âœ… å·²é‡ç½®ä¸ºé»˜è®¤è®¡åˆ’ï¼');
            }
        }
    </script>
</body>
</html>
